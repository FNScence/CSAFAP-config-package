// ===================================================================================
// PART 1: RAPID FIRE & RECOIL LOGIC (High FPS Version)
// ⚠️ Launch option required:   -testscript "../../csgo/cfg/CSAFAP/addons/.vtest"
//    This is also required:    bind "mouse1" "+M1"
// ===================================================================================

fps_max 450

// Follow recoil indicator
alias crosshair_follow "cl_crosshairsize 0.8; cl_crosshairthickness 1; cl_crosshairgap -5; cl_crosshaircolor 1;cl_crosshair_drawoutline false;cl_crosshairalpha 255;cl_crosshairstyle 4;cl_crosshairusealpha true"

// Base Setup
alias +M1 "alias M1! tick_master; init_loops; alias M1> -attack; +M1_logic"
alias -M1 "alias M1! ""; -M1_logic; alias M1>; -attack; spec_next"

cl_scoreboard_mouse_enable_binding +M2

// --- Follow-Recoil Logic (2-Step Delay) ---
alias d_1 "alias run_recoil d_2"
alias d_2 "counter_step; alias run_recoil d_1" 

// Warmup Phase (Steps 1-7)
alias rc_01 "alias counter_step rc_02"
alias rc_02 "alias counter_step rc_03"
alias rc_03 "alias counter_step rc_04"
alias rc_04 "alias counter_step rc_05"
alias rc_05 "alias counter_step rc_06"
alias rc_06 "alias counter_step rc_07"
alias rc_07 "alias counter_step rc_loop_on" 

// Infinite Flicker Loop
alias rc_loop_on  "cl_crosshair_recoil 1; crosshair_follow; alias counter_step rc_loop_off"
alias rc_loop_off "cl_crosshair_recoil 0; reset_crosshair_pro;  alias counter_step rc_loop_on"

// --- Rapid Fire Logic (18-Step Loop) ---
alias rf_01 "+attack; alias run_fire rf_02"
alias rf_02 "-attack; alias run_fire rf_03"
alias rf_03 "alias run_fire rf_04"
alias rf_04 "alias run_fire rf_05"
alias rf_05 "alias run_fire rf_06"
alias rf_06 "alias run_fire rf_07"
alias rf_07 "alias run_fire rf_08"
alias rf_08 "alias run_fire rf_09"
alias rf_09 "alias run_fire rf_10"
alias rf_10 "alias run_fire rf_11"
alias rf_11 "alias run_fire rf_12"
alias rf_12 "alias run_fire rf_13"
alias rf_13 "alias run_fire rf_14"
alias rf_14 "alias run_fire rf_15"
alias rf_15 "alias run_fire rf_16"
alias rf_16 "alias run_fire rf_17"
alias rf_17 "alias run_fire rf_18"
alias rf_18 "alias run_fire rf_01" 

// ===================================================================================
// PART 2: DYNAMIC LOGIC & TOGGLES
// ===================================================================================

// 1. Logic Helpers (Tick Logic)
alias tick_on "run_recoil; run_fire"
alias reset_on "alias run_recoil d_1; alias counter_step rc_01; alias run_fire rf_01"
alias reset_recoil_only "alias run_recoil d_1; alias counter_step rc_01"

// 2. Release Helpers (The Logic for -M1)
// release_full: Resets Recoil AND Crosshair Style (For when Recoil Mode is ON)
alias release_full   "cl_crosshair_recoil 0; reset_crosshair_pro"
// release_simple: Resets Recoil ONLY (For when Recoil Mode is OFF)
alias release_simple "cl_crosshair_recoil 0"

// 3. Logic Definitions (The actual mouse behaviors)

// Logic: OFF (Standard Mouse)
// On Release: Use simple release (Don't touch crosshair style)
alias logic_off "alias tick_master ""; alias +M1_logic +attack; alias -M1_logic release_simple; alias init_loops """

// Logic: Rifle Mode (Continuous Fire + Recoil Logic)
// On Release: Use full reset (Because we changed the crosshair)
alias logic_rifle "alias tick_master run_recoil; alias +M1_logic +attack; alias -M1_logic release_full; alias init_loops reset_recoil_only"

// Logic: Pistol Mode (Rapid Tap Fire + Recoil Logic)
// On Release: Use full reset (Because we changed the crosshair)
alias logic_pistol "alias tick_master tick_on; alias +M1_logic ""; alias -M1_logic release_full; alias init_loops reset_on"

// Logic: Rapid Only (No Recoil)
// On Release: Use simple release (We never changed the crosshair, so don't reset it)
alias logic_rapid_only "alias tick_master run_fire; alias +M1_logic ""; alias -M1_logic release_simple; alias init_loops alias run_fire rf_01"


// 4. The Toggle Actions

// ACTION: Turn OFF
alias rapid_mode_off "logic_off; load_slots_disabled; alias toggle_rapid current_setup_activator; echo [OFF]"

// ACTION: Turn ON (Selector)
alias current_setup_activator "current_setup"


// 5. Setup Configurations

// Setup 1: Rapid Only (Pistol) / Normal (Rifle)
alias rapid_setup_1 "alias current_setup setup_1; echo [SETUP_1_SELECTED]"

// Setup 2: All Features (Pistol Rapid / Rifle Recoil)
alias rapid_setup_2 "alias current_setup setup_2; echo [SETUP_2_SELECTED]"


// 6. The Actual ON Commands (Called by toggle key)
alias setup_1 "load_slots_enabled_1; last_slot_used; alias toggle_rapid rapid_mode_off; echo [ON:  RAPID FIRE]"
alias setup_2 "load_slots_enabled_2; last_slot_used; alias toggle_rapid rapid_mode_off; echo [ON:  FOLLOW-RECOIL + RAPID FIRE]"


// ===================================================================================
// PART 3: JUMPTHROW BINDS
// ===================================================================================

alias +JumpThrow alias JT! JT+1; alias -JumpThrow alias JT! JT-1; alias JT! ""
alias JT+1 "M1>; alias JT! JT+2"; alias JT+2 "M2>; alias JT! JT+3"; alias JT+3 "alias JT!; +jump"
alias JT-1 "jump -9999 f u; alias JT!"

alias +WJumpThrow alias JT! WT+1; alias -WJumpThrow alias JT! WT-1; alias JT! ""
alias WT+1 "+forward; alias JT! WT+2"; alias WT+2 "M1>; alias JT! WT+3"; alias WT+3 "M2>;alias JT! WT+4"
alias WT+4 "alias JT!;+jump"
alias WT-1 "forward -9999 f u; alias JT! WT-2"; alias WT-2 "alias JT!; jump -9999 f u"

alias +M2 alias M2! M2+; alias -M2 alias M2! M2-; alias M2! ""; alias M2> ""
alias M2+ "alias M2!; alias M2> -attack2; +attack2"; alias M2- "alias M2!; alias M2>; attack2 -9999 f u; spec_prev"
cl_scoreboard_mouse_enable_binding +M2


// ===================================================================================
// PART 4: WEAPON SWITCH & HAND LOGIC (With Memory)
// ===================================================================================
// A. ENABLED SLOTS (SETUP 2 - ALL FEATURES)
alias load_slots_enabled_2 "alias ef_slot1 s2_slot1; alias ef_slot2 s2_slot2; alias ef_slot3 s_off_slot3; alias ef_slot4 s_off_slot4; alias ef_slot5 s_off_slot5; alias ef_slot6 s_off_slot6; alias ef_slot7 s_off_slot7; alias ef_slot8 s_off_slot8; alias ef_slot9 s_off_slot9; alias ef_slot10 s_off_slot10"

alias s2_slot1  "slot1; set_slot1;  logic_rifle"
alias s2_slot2  "slot2; set_slot2;  logic_pistol"

// B. ENABLED SLOTS (SETUP 1 - RAPID ONLY)
alias load_slots_enabled_1 "alias ef_slot1 s1_slot1; alias ef_slot2 s1_slot2; alias ef_slot3 s_off_slot3; alias ef_slot4 s_off_slot4; alias ef_slot5 s_off_slot5; alias ef_slot6 s_off_slot6; alias ef_slot7 s_off_slot7; alias ef_slot8 s_off_slot8; alias ef_slot9 s_off_slot9; alias ef_slot10 s_off_slot10"

alias s1_slot1  "slot1; set_slot1;  logic_off"
alias s1_slot2  "slot2; set_slot2;  logic_rapid_only"

// C. DISABLED SLOTS / UTILITY (Always OFF)
alias load_slots_disabled "alias ef_slot1 s_off_slot1; alias ef_slot2 s_off_slot2; alias ef_slot3 s_off_slot3; alias ef_slot4 s_off_slot4; alias ef_slot5 s_off_slot5; alias ef_slot6 s_off_slot6; alias ef_slot7 s_off_slot7; alias ef_slot8 s_off_slot8; alias ef_slot9 s_off_slot9; alias ef_slot10 s_off_slot10"

// Standard definitions for disabled slots
alias s_off_slot1  "slot1; set_slot1;  logic_off"
alias s_off_slot2  "slot2; set_slot2;  logic_off"
alias s_off_slot3  "slot3; set_slot3; logic_off"
alias s_off_slot4  "slot4; set_slot4;  logic_off"
alias s_off_slot5  "slot5; set_slot5;  logic_off"
alias s_off_slot6  "slot6; set_slot6;  logic_off"
alias s_off_slot7  "slot7; set_slot7;  logic_off"
alias s_off_slot8  "slot8; set_slot8;  logic_off"
alias s_off_slot9  "slot9; set_slot9;  logic_off"
alias s_off_slot10 "slot10; set_slot10; logic_off"

// Quickswitch Logic (Fixed to update last_slot_used)
alias qs_slot1    "alias ef_invnext ef_slot2; alias ef_invprev ef_slot10; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot1; alias last_slot_used ef_slot1; alias set_slot1 ; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot2    "alias ef_invnext ef_slot3; alias ef_invprev ef_slot1; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot2; alias last_slot_used ef_slot2; alias set_slot1 qs_slot1; alias set_slot2 ; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot3    "alias ef_invnext ef_slot5; alias ef_invprev ef_slot2; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot3; alias last_slot_used ef_slot3; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 ; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot5    "alias ef_invnext ef_slot6; alias ef_invprev ef_slot3; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot5; alias last_slot_used ef_slot5; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 ; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot6    "alias ef_invnext ef_slot7; alias ef_invprev ef_slot5; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot6; alias last_slot_used ef_slot6; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 ; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot7    "alias ef_invnext ef_slot8; alias ef_invprev ef_slot6; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot7; alias last_slot_used ef_slot7; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 ; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"  
alias qs_slot8    "alias ef_invnext ef_slot9; alias ef_invprev ef_slot7; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot8; alias last_slot_used ef_slot8; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 ; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot9    "alias ef_invnext ef_slot10; alias ef_invprev ef_slot8; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot9; alias last_slot_used ef_slot9; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 ; alias set_slot10 qs_slot10"
alias qs_slot10   "alias ef_invnext ef_slot1; alias ef_invprev ef_slot9; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot10; alias last_slot_used ef_slot10; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10"

// Initialization
rapid_setup_2      // Select Setup 2
load_slots_enabled_1; last_slot_used; alias toggle_rapid rapid_mode_off
exec CSAFAP/crosshair/crosshair_mode/rpd
qs_slot2
ef_slot1           // Switch to Slot 1
alias reset_crosshair_pro "reset_crosshair;init_proch"