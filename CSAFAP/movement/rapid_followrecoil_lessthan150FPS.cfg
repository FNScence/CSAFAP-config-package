// ===================================================================================
// PART 1: RAPID FIRE & RECOIL LOGIC (Low FPS / Fast Timing Version)
// ⚠️ Launch option required:   -testscript "../../csgo/cfg/CSAFAP/addons/.vtest"
//    This is also required:    bind "mouse1" "+M1"
// ===================================================================================

fps_max 0 // Or set to your preference

// Follow recoil indicator
alias crosshair_follow "cl_crosshairsize 0.8; cl_crosshairthickness 1; cl_crosshairgap -5; cl_crosshaircolor 1;cl_crosshair_drawoutline false;cl_crosshairalpha 255;cl_crosshairstyle 4;cl_crosshairusealpha true"
// reset_crosshair is defined externally by user

// Base Setup
snd_toolvolume 0.05
alias +M1 "alias M1! tick_master; init_loops; alias M1> -attack; +M1_logic"
alias -M1 "alias M1! ""; cl_crosshair_recoil 0; reset_crosshair; alias M1>; -attack; spec_next"

// --- Follow-Recoil Logic (2-Step Delay) ---
// Retained 2-step divider as requested
alias d_1 "alias run_recoil d_2"
alias d_2 "counter_step; alias run_recoil d_1" 

// Warmup Phase (Steps 1-7)
alias rc_01 "alias counter_step rc_02"
alias rc_02 "alias counter_step rc_03"
alias rc_03 "alias counter_step rc_04"
alias rc_04 "alias counter_step rc_05"
alias rc_05 "alias counter_step rc_06"
alias rc_06 "alias counter_step rc_07"
alias rc_07 "alias counter_step rc_loop_on" 

// Infinite Flicker Loop
alias rc_loop_on  "cl_crosshair_recoil 1; crosshair_follow; alias counter_step rc_loop_off"
alias rc_loop_off "cl_crosshair_recoil 0; reset_crosshair;  alias counter_step rc_loop_on"

// --- Rapid Fire Logic (6-Step Loop) ---
// Reduced to 6 steps for Lower FPS (Higher fire rate per tick)
alias rf_01 "+attack; alias run_fire rf_02"
alias rf_02 "-attack; alias run_fire rf_03"
alias rf_03 "alias run_fire rf_04"
alias rf_04 "alias run_fire rf_05"
alias rf_05 "alias run_fire rf_06"
alias rf_06 "alias run_fire rf_01"

// ===================================================================================
// PART 2: DYNAMIC LOGIC (Split for Rifles vs Pistols)
// ===================================================================================

// 1. Logic Helpers
alias tick_on "run_recoil; run_fire"
alias reset_on "alias run_recoil d_1; alias counter_step rc_01; alias run_fire rf_01"
alias reset_recoil_only "alias run_recoil d_1; alias counter_step rc_01"

// 2. Logic Definitions

// Logic: OFF (Standard Mouse)
alias logic_off "alias tick_master ""; alias +M1_logic +attack; alias init_loops """

// Logic: Rifle Mode (Continuous Fire + Recoil Logic)
alias logic_rifle "alias tick_master run_recoil; alias +M1_logic +attack; alias init_loops reset_recoil_only"

// Logic: Pistol Mode (Rapid Tap Fire + Recoil Logic)
alias logic_pistol "alias tick_master tick_on; alias +M1_logic ""; alias init_loops reset_on"

// Logic: Rapid Only (No Recoil)
alias logic_rapid_only "alias tick_master run_fire; alias +M1_logic ""; alias init_loops alias run_fire rf_01"

// 3. Setup Commands
alias rapid_setup_1 "alias current_setup setup_1; echo [SETUP_1_SELECTED]"
alias rapid_setup_2 "alias current_setup setup_2; echo [SETUP_2_SELECTED]"

// State: OFF (Disabled) - No Sounds
alias rapid_mode_off_state "rapid_mode_off; load_slots_disabled; alias toggle_rapid current_setup_activator; echo [STATE: OFF]"

// Activators (No Sounds)
alias current_setup_activator "current_setup"
alias setup_1 "load_slots_enabled_1; last_slot_used; alias toggle_rapid rapid_mode_off_state; echo [STATE: ON_RAPID_ONLY]"
alias setup_2 "load_slots_enabled_2; last_slot_used; alias toggle_rapid rapid_mode_off_state; echo [STATE: ON_ALL_FEATURES]"

// ACTION: Turn OFF Helper
alias rapid_mode_off "logic_off; load_slots_disabled; alias toggle_rapid current_setup_activator; echo [STATE: OFF]"


// ===================================================================================
// PART 3: JUMPTHROW BINDS
// ===================================================================================

alias +JumpThrow alias JT! JT+1; alias -JumpThrow alias JT! JT-1; alias JT! ""
alias JT+1 "M1>; alias JT! JT+2"; alias JT+2 "M2>; alias JT! JT+3"; alias JT+3 "alias JT!; +jump"
alias JT-1 "jump -9999 f u; alias JT!"

alias +WJumpThrow alias JT! WT+1; alias -WJumpThrow alias JT! WT-1; alias JT! ""
alias WT+1 "+forward; alias JT! WT+2"; alias WT+2 "M1>; alias JT! WT+3"; alias WT+3 "M2>;alias JT! WT+4"
alias WT+4 "alias JT!;+jump"
alias WT-1 "forward -9999 f u; alias JT! WT-2"; alias WT-2 "alias JT!; jump -9999 f u"

alias +M2 alias M2! M2+; alias -M2 alias M2! M2-; alias M2! ""; alias M2> ""
alias M2+ "alias M2!; alias M2> -attack2; +attack2"; alias M2- "alias M2!; alias M2>; attack2 -9999 f u; spec_prev"
cl_scoreboard_mouse_enable_binding +M2


// ===================================================================================
// PART 4: WEAPON SWITCH & HAND LOGIC (With Memory)
// ===================================================================================
// A. ENABLED SLOTS (SETUP 2 - ALL FEATURES)
alias load_slots_enabled_2 "alias ef_slot1 s2_slot1; alias ef_slot2 s2_slot2; alias ef_slot3 s_off_slot3; alias ef_slot4 s_off_slot4; alias ef_slot5 s_off_slot5; alias ef_slot6 s_off_slot6; alias ef_slot7 s_off_slot7; alias ef_slot8 s_off_slot8; alias ef_slot9 s_off_slot9; alias ef_slot10 s_off_slot10"

alias s2_slot1  "slot1; set_slot1; switchhandsleft;  logic_rifle"
alias s2_slot2  "slot2; set_slot2; switchhandsleft;  logic_pistol"

// B. ENABLED SLOTS (SETUP 1 - RAPID ONLY)
alias load_slots_enabled_1 "alias ef_slot1 s1_slot1; alias ef_slot2 s1_slot2; alias ef_slot3 s_off_slot3; alias ef_slot4 s_off_slot4; alias ef_slot5 s_off_slot5; alias ef_slot6 s_off_slot6; alias ef_slot7 s_off_slot7; alias ef_slot8 s_off_slot8; alias ef_slot9 s_off_slot9; alias ef_slot10 s_off_slot10"

alias s1_slot1  "slot1; set_slot1; switchhandsleft;  logic_off"
alias s1_slot2  "slot2; set_slot2; switchhandsleft;  logic_rapid_only"

// C. DISABLED SLOTS / UTILITY (Always OFF)
alias load_slots_disabled "alias ef_slot1 s_off_slot1; alias ef_slot2 s_off_slot2; alias ef_slot3 s_off_slot3; alias ef_slot4 s_off_slot4; alias ef_slot5 s_off_slot5; alias ef_slot6 s_off_slot6; alias ef_slot7 s_off_slot7; alias ef_slot8 s_off_slot8; alias ef_slot9 s_off_slot9; alias ef_slot10 s_off_slot10"

alias s_off_slot1  "slot1; set_slot1; switchhandsleft;  logic_off"
alias s_off_slot2  "slot2; set_slot2; switchhandsleft;  logic_off"
alias s_off_slot3  "slot3; set_slot3; switchhandsright; logic_off"
alias s_off_slot4  "slot4; set_slot4; switchhandsleft;  logic_off"
alias s_off_slot5  "slot5; set_slot5; switchhandsleft;  logic_off"
alias s_off_slot6  "slot6; set_slot6; switchhandsleft;  logic_off"
alias s_off_slot7  "slot7; set_slot7; switchhandsleft;  logic_off"
alias s_off_slot8  "slot8; set_slot8; switchhandsleft;  logic_off"
alias s_off_slot9  "slot9; set_slot9; switchhandsleft;  logic_off"
alias s_off_slot10 "slot10; set_slot10; switchhandsleft; logic_off"

// Quickswitch Logic
alias qs_slot1    "alias ef_invnext ef_slot2; alias ef_invprev ef_slot10; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot1; alias last_slot_used ef_slot1; alias set_slot1 ; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot2    "alias ef_invnext ef_slot3; alias ef_invprev ef_slot1; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot2; alias last_slot_used ef_slot2; alias set_slot1 qs_slot1; alias set_slot2 ; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot3    "alias ef_invnext ef_slot5; alias ef_invprev ef_slot2; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot3; alias last_slot_used ef_slot3; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 ; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot5    "alias ef_invnext ef_slot6; alias ef_invprev ef_slot3; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot5; alias last_slot_used ef_slot5; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 ; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot6    "alias ef_invnext ef_slot7; alias ef_invprev ef_slot5; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot6; alias last_slot_used ef_slot6; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 ; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot7    "alias ef_invnext ef_slot8; alias ef_invprev ef_slot6; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot7; alias last_slot_used ef_slot7; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 ; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"  
alias qs_slot8    "alias ef_invnext ef_slot9; alias ef_invprev ef_slot7; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot8; alias last_slot_used ef_slot8; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 ; alias set_slot9 qs_slot9; alias set_slot10 qs_slot10"
alias qs_slot9    "alias ef_invnext ef_slot10; alias ef_invprev ef_slot8; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot9; alias last_slot_used ef_slot9; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 ; alias set_slot10 qs_slot10"
alias qs_slot10   "alias ef_invnext ef_slot1; alias ef_invprev ef_slot9; set_lastinv; alias set_lastinv alias ef_lastinv ef_slot10; alias last_slot_used ef_slot10; alias set_slot1 qs_slot1; alias set_slot2 qs_slot2; alias set_slot3 qs_slot3; alias set_slot5 qs_slot5; alias set_slot6 qs_slot6; alias set_slot7 qs_slot7; alias set_slot8 qs_slot8; alias set_slot9 qs_slot9; alias set_slot10"

// Initialization
rapid_setup_2      // Select Setup 2
setup_2            // Activate it
qs_slot2
ef_slot1           // Switch to Slot 1

// Binds
bind "CAPSLOCK" "toggle_rapid"
bind "mouse1" "+M1"
bind "mouse2" "+M2"